# 🔄 清除缓存更新指南

## 📱 iOS / iPhone / iPad

### **方法1: 删除并重新添加书签（推荐）**

1. 找到主屏幕上的"药盒助手"图标
2. **长按图标** → 选择"移除App" → "删除"
3. 打开 **Safari 浏览器**
4. 访问应用网址
5. 点击底部 **分享按钮** (方框+箭头)
6. 向下滚动，选择 **"添加到主屏幕"**
7. 点击 **"添加"**

✅ 现在打开应用，应该显示最新版本 `V251219.2`

---

### **方法2: 清除Safari缓存**

1. 打开 **设置** App
2. 向下滚动找到 **Safari**
3. 向下滚动找到 **"清除历史记录与网站数据"**
4. 点击 **"清除历史记录与数据"**
5. 确认清除
6. 重新打开"药盒助手"

---

### **方法3: 强制刷新（快速但不彻底）**

1. 打开"药盒助手" PWA
2. 下拉页面到最顶部
3. **继续下拉** 触发刷新
4. 松手等待页面重新加载

> ⚠️ 注意：此方法可能不会完全清除缓存

---

## 🤖 Android / 安卓手机

### **方法1: 清除应用数据（推荐）**

1. 打开 **设置**
2. 进入 **应用管理** 或 **应用**
3. 找到 **Chrome** 或应用所在的浏览器
4. 点击 **存储空间**
5. 点击 **清除缓存** 和 **清除数据**
6. 重新打开"药盒助手"

---

### **方法2: 删除并重新添加**

**Chrome浏览器：**
1. 找到主屏幕上的"药盒助手"图标
2. **长按图标** → 选择"卸载"或"移除"
3. 打开 **Chrome 浏览器**
4. 访问应用网址
5. 点击右上角 **⋮** (三个点)
6. 选择 **"安装应用"** 或 **"添加到主屏幕"**
7. 确认添加

---

### **方法3: 浏览器内清除缓存**

**Chrome：**
1. 打开 Chrome
2. 点击右上角 **⋮** (三个点)
3. 选择 **"历史记录"**
4. 点击 **"清除浏览数据"**
5. 选择 **"缓存的图片和文件"**
6. 选择时间范围：**"全部"**
7. 点击 **"清除数据"**

---

## 💻 电脑端（桌面浏览器）

### **Chrome / Edge**

**快捷键：**
```
Windows: Ctrl + Shift + Delete
Mac: Command + Shift + Delete
```

**或手动：**
1. 点击右上角 **⋮** (三个点)
2. 选择 **"更多工具"** → **"清除浏览数据"**
3. 勾选 **"缓存的图片和文件"**
4. 时间范围选择 **"全部时间"**
5. 点击 **"清除数据"**
6. 刷新页面（F5 或 Cmd+R）

---

### **Safari (Mac)**

1. 顶部菜单栏：**Safari** → **偏好设置**
2. 点击 **"高级"** 选项卡
3. 勾选 **"在菜单栏中显示开发菜单"**
4. 顶部菜单栏：**开发** → **清空缓存**
5. 刷新页面（Cmd+R）

---

## 🔍 如何确认版本已更新？

打开应用后，查看以下位置的版本号：

### **位置1: 页面标题**
```
药盒助手 V251219.2  ← 应该显示这个
```

### **位置2: "我的"页面 → "关于应用"**
```
版本 V251219.2
```

### **位置3: 浏览器控制台**
```javascript
// 在控制台输入
APP_VERSION
// 应该输出: "V251219.2"
```

---

## ⚡ 自动更新机制（已实现）

### **工作原理：**

1. **版本检测**：每次打开应用时自动检测版本号
2. **缓存清除**：如果版本号不同，自动清除旧缓存
3. **自动刷新**：清除缓存后自动刷新页面
4. **Service Worker**：自动注销旧版本，注册新版本

### **触发时机：**

- ✅ 打开应用时立即检测
- ✅ Service Worker 每次启动时检查
- ✅ 从后台切换回前台时检测

### **控制台日志：**

如果自动更新成功，你会看到：

```
📦 当前版本: V251219.2
🔄 检测到版本更新: V251219.1 → V251219.2
🗑️ 清除缓存: meds-cache-V251219.1
✅ 缓存已清除
🗑️ 已注销旧的 Service Worker
✅ Service Worker 注册成功
```

---

## 🆘 故障排查

### **问题1: 版本号还是旧的**

**解决方案：**
1. 按照上面的清除缓存步骤操作
2. 确保网络连接正常
3. 尝试切换到移动数据或WiFi
4. 等待5-10秒让Service Worker完成更新

---

### **问题2: iOS书签无法更新**

**原因：** iOS对PWA缓存管理较严格

**解决方案：**
1. **必须删除旧书签**
2. **清除Safari缓存**
3. **重新添加书签**
4. 这是目前最可靠的方法

---

### **问题3: 页面一直刷新循环**

**解决方案：**
```javascript
// 浏览器控制台执行
localStorage.clear()
location.reload()
```

---

### **问题4: Service Worker 注册失败**

**解决方案：**
1. 检查是否使用 HTTPS 或 localhost
2. 浏览器控制台查看错误信息
3. 手动注销所有 Service Worker：

```javascript
navigator.serviceWorker.getRegistrations().then(function(registrations) {
  for (let registration of registrations) {
    registration.unregister()
  }
}).then(() => location.reload())
```

---

## 📊 版本历史

| 版本 | 日期 | 主要更新 |
|------|------|---------|
| V251219.1 | 2025-12-19 | 初始版本更新系统 |
| V251219.2 | 2025-12-19 | 修复UI、强制更新机制 |

---

## 💡 开发者提示

### **每次发布新版本：**

```bash
# 1. 更新版本号
npm run update-version "更新说明"

# 2. 构建
npm run build

# 3. 推送
git push

# 4. 通知用户（如需要）
# 所有设备会在打开应用时自动更新
```

### **测试更新流程：**

```bash
# 1. 打开浏览器控制台
# 2. 输入以下命令模拟旧版本
localStorage.setItem('app_version', 'V251219.1')

# 3. 刷新页面
location.reload()

# 4. 应该看到自动清除缓存并更新
```

---

## 📞 需要帮助？

如果以上方法都无法解决问题：

1. 截图当前版本号显示
2. 截图浏览器控制台日志
3. 说明使用的设备和浏览器
4. 反馈给开发者

---

**最后更新**: 2025年12月19日  
**当前最新版本**: V251219.2

