# 本地测试模式说明

## 🔧 什么是本地测试模式？

本地测试模式允许你在**没有 Supabase 云端连接**的情况下测试应用的所有功能。所有数据都保存在浏览器的本地存储（LocalStorage 和 IndexedDB）中。

---

## ⚠️ 为什么需要本地测试模式？

当你遇到以下情况时，可以使用本地测试模式：

1. **网络连接问题**：无法访问 Supabase 服务器
2. **登录失败**：显示 "Failed to fetch" 错误
3. **快速测试**：想要快速测试应用功能，不需要真实的云端同步
4. **离线开发**：在没有网络的环境下开发和测试

---

## 🚀 如何启用本地测试模式？

### 方法 1：使用登录页面按钮（推荐）

1. 打开应用：http://localhost:5173/meds/
2. 在登录页面，点击 **"🔧 启用本地测试模式"** 按钮
3. 页面会自动刷新
4. 现在可以使用**任意用户名和密码**登录

### 方法 2：使用浏览器控制台

1. 打开浏览器开发者工具（F12）
2. 切换到 Console（控制台）标签
3. 输入以下命令：
   ```javascript
   localStorage.setItem('USE_LOCAL_MODE', 'true')
   ```
4. 刷新页面（F5 或 Ctrl+R）

---

## 📝 本地测试模式下的登录

启用本地测试模式后：

- ✅ **用户名**：可以输入任意用户名（例如：`测试用户`）
- ✅ **密码**：可以输入任意密码（例如：`123456`）
- ✅ **登录验证**：会自动跳过 Supabase 认证
- ✅ **数据存储**：所有数据保存在浏览器本地

### 示例登录

```
用户名：张三
密码：123456
```

点击"登录"按钮即可成功登录！

---

## 🎯 本地测试模式支持的功能

### ✅ 完全支持的功能

1. **药品管理**
   - ✅ 添加药品
   - ✅ 删除药品
   - ✅ 编辑药品信息

2. **服药记录**
   - ✅ 拍照记录服药
   - ✅ 查看服药历史
   - ✅ 时间线展示

3. **用户设置**
   - ✅ 修改用户名
   - ✅ 上传头像
   - ✅ 提醒设置

4. **本地数据持久化**
   - ✅ 数据保存在 IndexedDB
   - ✅ 刷新页面后数据不丢失

### ⚠️ 受限的功能

1. **云端同步**
   - ❌ 无法同步到 Supabase 云端
   - ❌ 无法在多设备间同步
   - ⚠️ "云端保存"和"云端读取"按钮可能无法使用

2. **实时同步**
   - ❌ 无法接收其他设备的实时更新

---

## 🔄 如何切换回云端模式？

如果你想恢复使用 Supabase 云端同步：

### 方法 1：清除本地测试模式标记

1. 打开浏览器控制台（F12）
2. 输入：
   ```javascript
   localStorage.removeItem('USE_LOCAL_MODE')
   ```
3. 刷新页面

### 方法 2：清除所有浏览器数据

1. 打开浏览器设置
2. 清除浏览器缓存和数据
3. 重新打开应用

---

## 📊 数据存储位置

在本地测试模式下，数据存储在以下位置：

| 数据类型 | 存储位置 | 说明 |
|---------|---------|------|
| 登录状态 | LocalStorage | `isLoggedIn`, `username` |
| 用户ID | LocalStorage | `mock_user_id` |
| 药品列表 | IndexedDB | `medications` 表 |
| 服药记录 | IndexedDB | `medication_logs` 表 |
| 用户设置 | IndexedDB | `user_settings` 表 |

---

## 🧪 测试建议

### 测试步骤

1. **启用本地测试模式**
   ```
   点击"启用本地测试模式"按钮
   ```

2. **登录**
   ```
   用户名：测试用户
   密码：123456
   ```

3. **添加药品**
   ```
   - 点击底部"药品"按钮
   - 添加测试药品（例如：维生素C）
   ```

4. **记录服药**
   ```
   - 点击"首页"标签
   - 点击相机按钮拍照
   - 验证记录是否保存
   ```

5. **查看历史**
   ```
   - 点击"记录"标签
   - 查看服药历史记录
   ```

6. **修改个人信息**
   ```
   - 点击"我的"标签
   - 修改用户名和头像
   ```

---

## ⚠️ 注意事项

### 数据安全

- ⚠️ 本地测试模式的数据**仅保存在当前浏览器**中
- ⚠️ 清除浏览器缓存会**删除所有数据**
- ⚠️ 不同浏览器的数据**互不相通**

### 功能限制

- ❌ 无法在多设备间同步数据
- ❌ 无法备份到云端
- ❌ 无法恢复已删除的数据

### 适用场景

- ✅ 本地开发和测试
- ✅ 演示和展示
- ✅ 功能验证
- ❌ 生产环境使用（建议配置 Supabase）

---

## 🔍 故障排除

### 问题 1：启用本地模式后仍然无法登录

**解决方案**：
1. 清除浏览器缓存（Ctrl+Shift+Delete）
2. 重新打开应用
3. 再次点击"启用本地测试模式"

### 问题 2：数据没有保存

**解决方案**：
1. 检查浏览器是否允许 LocalStorage 和 IndexedDB
2. 打开控制台查看是否有错误信息
3. 尝试使用无痕模式测试

### 问题 3：想要清除所有测试数据

**解决方案**：
```javascript
// 在浏览器控制台执行
localStorage.clear();
indexedDB.deleteDatabase('MedicationTrackerDB');
location.reload();
```

---

## 📞 需要帮助？

如果遇到问题：

1. 查看浏览器控制台的错误信息
2. 检查 `本地测试模式说明.md` 文档
3. 参考 `快速上手_V251219.17.md` 了解完整功能

---

## 🎉 总结

本地测试模式是一个**快速测试和开发**的好工具！

| 特性 | 本地测试模式 | 云端模式 |
|-----|------------|---------|
| 登录验证 | 跳过 | Supabase 认证 |
| 数据存储 | 浏览器本地 | Supabase 云端 |
| 多设备同步 | ❌ | ✅ |
| 离线使用 | ✅ | ❌ |
| 数据备份 | ❌ | ✅ |

**建议**：
- 开发测试时使用**本地测试模式**
- 生产环境使用**云端模式**（配置 Supabase）

---

**文档版本**：V1.0  
**最后更新**：2025年1月2日  
**适用版本**：V251219.42

