{
  "V251219.28": {
    "version": "V251219.28",
    "date": "2025-12-20",
    "title": "彻底修复非UUID字符串写入UUID字段的问题",
    "content": [
      "🔒 升级sanitizePayload：使用UUID正则校验，禁止所有非UUID字符串",
      "🐛 修复med_xxx格式ID写入UUID字段的问题",
      "🐛 修复medications写入时accent字段不存在的错误",
      "✅ medication_logs：medication_id不是UUID时查找云端ID或跳过",
      "✅ medications：只发送数据库真实存在的字段",
      "🛡️ 多重防御检查，确保绝对不传非UUID到UUID字段"
    ]
  },
  "V251219.27": {
    "version": "V251219.27",
    "date": "2025-12-20",
    "title": "修复local_xxx ID写入UUID字段的错误（22P02）",
    "content": [
      "🐛 修复 local_xxx 格式ID写入UUID字段导致的22P02错误",
      "✅ 添加防御性检查函数，自动移除local_xxx格式的ID",
      "🔧 medications插入：local_xxx时使用insert让数据库生成UUID",
      "🔧 medication_logs插入：绝对不传id，让数据库自动生成",
      "🔧 medication_logs插入：local_xxx的medication_id时查找云端ID",
      "💾 同步成功后保存云端返回的UUID，保留本地local_id",
      "🛡️ 最小修改原则，不影响现有业务流程"
    ]
  },
  "V251219.26": {
    "version": "V251219.26",
    "date": "2025-12-20",
    "title": "修复数据库表结构不匹配导致的同步错误",
    "content": [
      "🐛 修复 'local_id' 字段不存在的错误（PGRST204）",
      "🐛 修复 'accent' 字段可能不存在的错误（400 Bad Request）",
      "🔧 修复 image_hash 查询的 406 错误",
      "✅ 只发送数据库存在的字段，避免字段不匹配",
      "📝 创建数据库表结构修复脚本（supabase-schema-fix.sql）",
      "🛡️ 添加错误处理和降级方案"
    ]
  },
  "V251219.25": {
    "version": "V251219.25",
    "date": "2025-12-20",
    "title": "修复记录中照片显示问题并添加调试信息",
    "content": [
      "🐛 修复时间线记录中照片不显示的问题",
      "🖼️ 添加图片加载错误处理和占位符",
      "🔍 添加详细的调试日志（图片上传、保存、加载）",
      "✅ 确保 image_path 正确保存和显示",
      "📊 添加数据验证和诊断信息"
    ]
  },
  "V251219.24": {
    "version": "V251219.24",
    "date": "2025-12-20",
    "title": "添加Storage自动降级和错误处理",
    "content": [
      "🛡️ 添加Storage bucket自动降级功能（bucket不存在时使用DataURL）",
      "✅ 上传失败时自动降级到本地存储，不影响功能",
      "🔍 添加bucket存在性检查功能",
      "💡 友好的错误提示和诊断信息",
      "📝 创建Storage诊断指南"
    ]
  },
  "V251219.23": {
    "version": "V251219.23",
    "date": "2025-12-20",
    "title": "药品管理改为直接页面，支持自定义颜色",
    "content": [
      "📄 药品管理从弹出式改为直接页面（类似主页）",
      "🎨 颜色选择改为自定义颜色选择器（支持任意颜色）",
      "✨ 药品卡片支持自定义颜色显示",
      "🔧 优化药品管理页面布局和交互体验"
    ]
  },
  "V251219.22": {
    "version": "V251219.22",
    "date": "2025-12-20",
    "title": "恢复药品编辑功能",
    "content": [
      "✅ 恢复药品列表中的编辑按钮",
      "✏️ 支持修改药品名称、剂量、服用时间和颜色",
      "🎨 编辑界面与添加界面保持一致的设计风格",
      "💾 编辑后自动标记为已修改，提示保存到云端"
    ]
  },
  "V251219.21": {
    "version": "V251219.21",
    "date": "2025-12-19",
    "title": "完整重构云端同步逻辑，优化性能和用户体验",
    "content": [
      "🔄 完整实现云端保存和读取逻辑（基于技术文档）",
      "⚡ 优化性能：减少查询、批量操作、智能冲突检测",
      "🤖 添加自动同步机制（Realtime监听快照变化）",
      "✅ 正确读取用户名（从user_settings）",
      "📊 LWW冲突解决策略：自动加载最新数据",
      "🎯 数据变更自动标记为dirty，提示用户保存",
      "🚀 云端保存和读取速度大幅提升"
    ]
  },
  "V251219.20": {
    "version": "V251219.20",
    "date": "2025-12-19",
    "title": "内置Supabase配置，无需手动设置",
    "content": [
      "🎯 直接内置默认Supabase配置",
      "✨ 所有设备开箱即用，无需配置",
      "🔒 保持配置优先级：环境变量 > localStorage > 默认配置"
    ]
  },
  "V251219.19": {
    "version": "V251219.19",
    "date": "2025-12-19",
    "title": "修复生产环境Supabase配置问题",
    "content": [
      "🔧 支持从localStorage读取Supabase配置",
      "✅ 解决GitHub Pages无法读取.env的问题",
      "📝 生产环境现在可以正常使用云端快照功能"
    ]
  },
  "V251219.18": {
    "version": "V251219.18",
    "date": "2025-12-19",
    "title": "优化云端快照按钮位置和错误处理",
    "content": [
      "🎨 将云端保存和云端读取按钮移至标题右侧",
      "🔧 修复Supabase未配置时的报错问题",
      "✅ 添加友好的错误提示信息",
      "📏 优化按钮尺寸和间距（更紧凑）"
    ]
  },
  "V251219.17": {
    "version": "V251219.17",
    "date": "2025-12-19",
    "title": "添加云端快照管理功能，解决多设备同步冲突",
    "content": [
      "✨ 新增【云端保存】按钮：手动保存快照到云端",
      "✨ 新增【云端读取】按钮：从云端加载最新快照",
      "🔍 保存前自动检测冲突：检查云端是否被其他设备更新",
      "⚠️ LWW策略：Last Write Wins，基于服务器时间戳",
      "📝 快照版本管理：通过snapshot_label跟踪版本历史",
      "🎯 解决多设备同时修改的冲突问题",
      "💾 完整的数据快照：包含药品、记录、用户设置"
    ]
  },
  "V251219.16": {
    "version": "V251219.16",
    "date": "2025-12-19",
    "title": "修复App.tsx中的用户设置同步确认对话框",
    "content": [
      "🔧 移除App.tsx中用户名等设置的确认对话框",
      "⚡ 恢复所有设置的自动同步（包括用户名）",
      "✅ 设备A修改用户名后，设备B自动刷新应用",
      "🔔 显示蓝色通知：设置已从其他设备同步",
      "🎯 完全实现自动同步，无任何确认对话框"
    ]
  },
  "V251219.15": {
    "version": "V251219.15",
    "date": "2025-12-19",
    "title": "修复多设备实时同步机制",
    "content": [
      "🔧 移除V251219.14中添加的确认对话框",
      "⚡ 恢复自动同步机制",
      "🔄 设备A修改数据后，设备B立即自动同步",
      "✅ 显示友好的通知提示（右上角绿色通知）",
      "🎯 符合现代应用的即时同步体验",
      "📱 同步延迟 < 1秒"
    ]
  },
  "V251219.14": {
    "version": "V251219.14",
    "date": "2025-12-19",
    "title": "基于云端同步技术文档增强多设备实时同步",
    "content": [
      "🔔 增强Realtime监听，检测到变更后弹出确认对话框",
      "💬 用户可选择立即同步或稍后同步",
      "📊 显示详细的变更信息（设备/药品/时间）",
      "👤 优化用户设置同步，显示具体变更内容",
      "⚡ 实现真正的实时同步，同一用户的所有设备立即更新",
      "✨ 基于云端同步技术文档的LWW策略"
    ]
  },
  "V251219.13": {
    "version": "V251219.13",
    "date": "2025-12-19",
    "title": "将编辑按钮移至药品管理页面",
    "content": [
      "🔧 从主页药品卡片移除编辑按钮",
      "✏️ 在药品管理弹窗的\"当前药品列表\"中添加编辑按钮",
      "🎨 编辑按钮为蓝色圆形按钮，删除按钮为红色",
      "📋 所有药品编辑操作统一在药品管理页面进行",
      "✨ 优化用户操作流程，功能更集中"
    ]
  },
  "V251219.12": {
    "version": "V251219.12",
    "date": "2025-12-19",
    "title": "添加药品编辑功能并优化卡片高度",
    "content": [
      "✏️ 新增药品编辑功能（支持修改名称/剂量/颜色/时间）",
      "🎯 药品卡片右上角显示编辑按钮（hover显示）",
      "📱 优化药品卡片高度至原来的3/5（移动端友好）",
      "🎨 编辑弹窗支持实时颜色预览",
      "💾 编辑后自动同步到所有设备",
      "✅ 成功保存后显示绿色提示通知"
    ]
  },
  "V251219.11": {
    "version": "V251219.11",
    "date": "2025-12-19",
    "title": "药品卡片颜色完全自定义",
    "content": [
      "🎨 删除固定的3个颜色主题（柠檬绿/薄荷蓝/莓果粉）",
      "🌈 支持自由选择任意颜色作为卡片背景",
      "✨ 新增颜色预览和实时调整功能",
      "🎯 提供6个推荐快捷颜色",
      "📋 日历视图和药品管理自动适配自定义颜色",
      "💫 卡片颜色保存到数据库，多设备同步"
    ]
  },
  "V251219.10": {
    "version": "V251219.10",
    "date": "2025-12-19",
    "title": "优化安卓手机UI显示并简化设置",
    "content": [
      "📱 用户信息卡片高度减半，适配安卓小屏幕",
      "📊 统计卡片优化安卓样式（减少内边距和字体）",
      "🔄 删除数据同步设置选项（功能永久开启）",
      "✨ 多设备实时同步功能始终启用，无需手动设置",
      "🎨 改进移动端布局，提升用户体验"
    ]
  },
  "V251219.9": {
    "version": "V251219.9",
    "date": "2025-12-19",
    "title": "基于技术文档增强版本检测更新机制",
    "content": [
      "🔍 多维度更新检测（Service Worker状态 + 文件内容 + 版本号比较）",
      "⏰ 每10秒自动检查更新，确保及时发现新版本",
      "🚀 强缓存控制，使用多个缓存破坏参数",
      "📋 支持从update-log.json读取详细更新内容",
      "🔄 改进Service Worker消息处理机制",
      "🛡️ 防止刷新循环，使用sessionStorage标志",
      "📖 新增VERSION_DETECTION_SYSTEM.md技术文档",
      "⚡ 创建update-version.cjs自动版本更新脚本"
    ]
  },
  "V251219.8": {
    "version": "V251219.8",
    "date": "2025-12-19",
    "title": "优化多设备实时同步机制",
    "content": [
      "✨ 药品列表自动同步（无需手动确认）",
      "⚡ 同步间隔缩短到3秒，提升同步速度",
      "🔍 增强Realtime监听和日志输出",
      "📋 新增多设备同步测试文档",
      "✅ 改进版本检测和更新机制"
    ]
  },
  "V251219.7": {
    "version": "V251219.7",
    "date": "2025-12-19",
    "title": "创建强制更新工具解决浏览器缓存问题",
    "content": [
      "🔧 创建强制更新工具（force-update.html）",
      "📖 添加详细的更新指南（HOW_TO_UPDATE.md）",
      "🎯 解决浏览器缓存导致无法更新的问题",
      "✅ 支持一键清除缓存并更新"
    ]
  },
  "V251219.6": {
    "version": "V251219.6",
    "date": "2025-12-19",
    "title": "添加版本更新规则并升级版本号",
    "content": [
      "📋 创建VERSION_RULES.md版本管理规则",
      "🤖 建立AI助手版本更新提醒机制",
      "✅ 确保每次推送前版本号递增",
      "📝 详细的版本号管理流程"
    ]
  },
  "V251219.5": {
    "version": "V251219.5",
    "date": "2025-12-19",
    "title": "修复头像多设备同步功能并优化用户体验",
    "content": [
      "🔧 修复本地更新不刷新问题",
      "☁️ 优化云端推送逻辑",
      "🔄 实现多设备实时同步（LWW策略）",
      "📏 用户信息卡片高度优化",
      "🎨 显示头像缩略图"
    ]
  }
}

