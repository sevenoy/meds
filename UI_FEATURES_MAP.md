# 前端 UI 功能映射表

## 📱 页面布局

### 主页面 (`MainApp.tsx`)

**文件位置**: `frontend/src/components/MainApp.tsx`

**UI 区域**:
1. **顶部导航栏** (Header)
   - 左侧: "药盒助手" 标题
   - 右侧: 登出按钮
   - **功能**: 应用标识 + 登出功能

2. **TODAY 标题区域**
   - 左侧: 巨大的 "TODAY" 标题
   - 右侧: 同步状态指示器
   - **功能**: 视觉标识 + 同步状态显示

3. **进度和历史区域** (网格布局)
   - 左侧 (1/3): 今日进度卡片
   - 右侧 (2/3): 最近7天记录卡片
   - **功能**: 数据可视化展示

4. **药品列表区域**
   - 标题和添加按钮
   - 药品卡片网格
   - **功能**: 药品管理

---

## 🎨 UI 组件详细说明

### 1. 顶部导航栏

**组件**: `MainApp.tsx` (第 47-60 行)

**UI 元素**:
```
┌─────────────────────────────────────┐
│ 药盒助手                    [登出]  │
└─────────────────────────────────────┘
```

**功能**:
- **标题**: 显示应用名称
- **登出按钮**: 
  - 点击后清除登录状态
  - 返回登录页面（如果启用登录）

**API 需求**: `POST /api/auth/logout`

---

### 2. TODAY 标题

**组件**: `MainApp.tsx` (第 64-66 行)

**UI 元素**:
```
TODAY                    [已同步 09:00]
```

**样式**:
- 字体: `text-6xl md:text-8xl` (超大号)
- 字重: `font-black` (最粗)
- 样式: `italic` (斜体)
- 颜色: 黑色

**功能**: 视觉强调"今日"概念

---

### 3. 同步状态指示器

**组件**: `SyncStatusIndicator.tsx`

**UI 元素**:
- **已同步**: ✅ 绿色勾号 + "已同步 09:00"
- **同步中**: 🔄 蓝色旋转图标 + "同步中..."
- **同步失败**: ❌ 红色叉号 + "同步失败"

**功能**:
- 实时显示数据同步状态
- 显示最后同步时间

**API 需求**: `GET /api/sync/status`

---

### 4. 今日进度卡片

**组件**: `TodayProgress.tsx`

**UI 元素**:
```
┌─────────────────┐
│   今日进度      │
│                 │
│    [环形图]     │
│      60%        │
│                 │
│ 已完成 3 / 5    │
└─────────────────┘
```

**功能**:
- 显示今日服药完成百分比
- 环形进度图可视化
- 显示已完成/总数

**数据来源**:
- 所有药品列表
- 今日所有服药记录

**API 需求**:
- `GET /api/medications` - 获取药品列表
- `GET /api/logs?date=today` - 获取今日记录

**计算逻辑**:
```typescript
percentage = (已服用的药品数量 / 总药品数量) * 100
```

---

### 5. 最近7天记录卡片

**组件**: `LogHistory.tsx`

**UI 元素**:
```
┌─────────────────────────────┐
│   最近7天记录               │
│                             │
│  [照片] 阿司匹林  ✅ 按时   │
│         09:00  今天         │
│                             │
│  [照片] 维生素C  ⚠️ 延迟   │
│         12:30  今天         │
│                             │
└─────────────────────────────┘
```

**功能**:
- 显示最近7天的服药记录
- 每条记录包含:
  - 照片缩略图 (64x64px)
  - 药品名称
  - 状态图标和文字
  - 服药时间
  - 日期（今天/昨天/具体日期）

**状态显示**:
- `ontime` - ✅ 绿色勾号 + "按时"
- `late` - ⚠️ 橙色警告 + "延迟"
- `manual` - 🕐 灰色时钟 + "手动"

**API 需求**: `GET /api/logs?days=7`

---

### 6. 药品列表标题栏

**组件**: `MedicationList.tsx` (第 110-119 行)

**UI 元素**:
```
┌─────────────────────────────────┐
│ 今日药品          [+ 添加药品]  │
└─────────────────────────────────┘
```

**功能**:
- 显示区域标题
- 提供添加药品入口

**交互**:
- 点击"添加药品" → 打开添加药品模态框

---

### 7. 药品卡片

**组件**: `MedicationList.tsx` (第 129-171 行)

**UI 元素**:
```
┌─────────────────────────────┐
│ ● 阿司匹林                  │
│   剂量: 1片                 │
│   🕐 09:00                  │
│                             │
│  [📷 拍照记录] [✏️] [🗑️]   │
└─────────────────────────────┘
```

**功能**:
- 显示药品基本信息
- 颜色标识（左侧圆点）
- 操作按钮

**颜色主题**:
- `lime` - 青柠色 (绿色)
- `berry` - 浆果色 (粉色)
- `mint` - 薄荷色 (青色)
- `blue` - 蓝色
- `purple` - 紫色
- `orange` - 橙色

**操作按钮**:
1. **拍照记录** (主要按钮)
   - 点击 → 打开拍照模态框
   - API: `POST /api/logs`

2. **编辑** (铅笔图标)
   - 点击 → 打开编辑模态框
   - API: `PUT /api/medications/:id`

3. **删除** (垃圾桶图标)
   - 点击 → 确认删除
   - API: `DELETE /api/medications/:id`

---

### 8. 添加/编辑药品模态框

**组件**: `AddMedicationModal.tsx`

**UI 元素**:
```
┌─────────────────────────────┐
│  添加药品              [×]  │
├─────────────────────────────┤
│  药品名称 *                 │
│  [________________]         │
│                             │
│  剂量 *                     │
│  [________________]         │
│                             │
│  服药时间 *                 │
│  [09:00        ▼]          │
│                             │
│  颜色主题                   │
│  [🟢][🔴][🔵][🟣][🟠][🟡] │
│  选择: 青柠                 │
│                             │
│  [取消]    [添加]           │
└─────────────────────────────┘
```

**功能**:
- 添加新药品
- 编辑已有药品
- 表单验证
- 颜色主题选择

**表单字段**:
1. **药品名称** (必填)
   - 类型: 文本输入
   - 验证: 不能为空

2. **剂量** (必填)
   - 类型: 文本输入
   - 示例: "1片", "2粒", "10ml"
   - 验证: 不能为空

3. **服药时间** (必填)
   - 类型: 时间选择器
   - 格式: HH:mm (如 "09:00")
   - 验证: 必须选择时间

4. **颜色主题** (可选)
   - 类型: 6个颜色按钮
   - 默认: "lime" (青柠)
   - 选择后显示选中状态

**API 需求**:
- `POST /api/medications` - 创建药品
- `PUT /api/medications/:id` - 更新药品

**请求体格式**:
```json
{
  "name": "阿司匹林",
  "dosage": "1片",
  "scheduled_time": "09:00",
  "accent": "lime"
}
```

---

### 9. 拍照记录模态框

**组件**: `CameraModal.tsx`

**UI 元素** (拍照阶段):
```
┌─────────────────────────────┐
│  记录 阿司匹林         [×]  │
├─────────────────────────────┤
│                             │
│     [摄像头预览区域]        │
│                             │
│    [📷 拍照]                │
└─────────────────────────────┘
```

**UI 元素** (预览阶段):
```
┌─────────────────────────────┐
│  记录 阿司匹林         [×]  │
├─────────────────────────────┤
│     [拍摄的照片预览]        │
│                             │
│  拍摄时间: 2026-01-03 09:00 │
│  时间来源: 系统时间         │
│                             │
│  [重拍]    [✓ 确认]         │
└─────────────────────────────┘
```

**功能**:
- 调用设备摄像头
- 实时视频预览
- 拍照并捕获图像
- 显示照片预览
- 显示拍摄时间信息
- 确认保存记录

**交互流程**:
1. 打开模态框 → 请求摄像头权限
2. 显示视频流
3. 点击"拍照" → 捕获图像到 Canvas
4. 显示照片预览和时间信息
5. 点击"确认" → 保存记录
6. 点击"重拍" → 返回拍照界面

**API 需求**: `POST /api/logs`

**请求体格式**:
```json
{
  "medication_id": "uuid",
  "image_data": "data:image/jpeg;base64,/9j/4AAQ...",
  "taken_at": "2026-01-03T09:00:00Z",
  "time_source": "system",
  "image_hash": "sha256_hash"
}
```

**后端处理**:
1. 接收 Base64 DataURL
2. 解码为二进制数据
3. 上传到 Storage (如 Supabase Storage)
4. 返回公开 URL
5. 保存 URL 到数据库

---

## 📊 数据流图

### 添加药品流程
```
用户点击"添加药品"
  ↓
打开 AddMedicationModal
  ↓
填写表单 (name, dosage, time, color)
  ↓
点击"添加"
  ↓
调用 POST /api/medications
  ↓
保存到本地 IndexedDB
  ↓
更新 UI，显示新药品卡片
```

### 拍照记录流程
```
用户点击"拍照记录"
  ↓
打开 CameraModal
  ↓
请求摄像头权限
  ↓
显示视频预览
  ↓
点击"拍照"
  ↓
Canvas 捕获图像
  ↓
转换为 Base64 DataURL
  ↓
显示照片预览
  ↓
点击"确认"
  ↓
调用 POST /api/logs
  ↓
保存到本地 IndexedDB
  ↓
更新进度和历史记录
```

### 进度计算流程
```
TodayProgress 组件挂载
  ↓
调用 GET /api/medications
  ↓
调用 GET /api/logs?date=today
  ↓
过滤今日记录
  ↓
统计已服用的药品 (去重)
  ↓
计算百分比: (已完成 / 总数) * 100
  ↓
更新环形进度图
```

---

## 🔌 API 接口映射

### 药品管理

| UI 操作 | 组件 | API 接口 | 方法 |
|---------|------|----------|------|
| 加载药品列表 | MedicationList | `/api/medications` | GET |
| 添加药品 | AddMedicationModal | `/api/medications` | POST |
| 编辑药品 | AddMedicationModal | `/api/medications/:id` | PUT |
| 删除药品 | MedicationList | `/api/medications/:id` | DELETE |

### 服药记录

| UI 操作 | 组件 | API 接口 | 方法 |
|---------|------|----------|------|
| 拍照记录 | CameraModal | `/api/logs` | POST |
| 加载历史记录 | LogHistory | `/api/logs?days=7` | GET |
| 加载今日记录 | TodayProgress | `/api/logs?date=today` | GET |

### 统计

| UI 操作 | 组件 | API 接口 | 方法 |
|---------|------|----------|------|
| 计算今日进度 | TodayProgress | `/api/stats/today` | GET |

### 同步

| UI 操作 | 组件 | API 接口 | 方法 |
|---------|------|----------|------|
| 显示同步状态 | SyncStatusIndicator | `/api/sync/status` | GET |

---

## 📝 组件文件清单

| 组件 | 文件路径 | 主要功能 |
|------|---------|---------|
| MainApp | `components/MainApp.tsx` | 主应用容器，布局管理 |
| MedicationList | `components/MedicationList.tsx` | 药品列表和卡片 |
| AddMedicationModal | `components/AddMedicationModal.tsx` | 添加/编辑药品表单 |
| CameraModal | `components/CameraModal.tsx` | 拍照功能 |
| TodayProgress | `components/TodayProgress.tsx` | 今日进度显示 |
| LogHistory | `components/LogHistory.tsx` | 历史记录列表 |
| ProgressRing | `components/ProgressRing.tsx` | 环形进度图 |
| SyncStatusIndicator | `components/SyncStatusIndicator.tsx` | 同步状态显示 |

---

## 🎯 功能完整性检查

### ✅ 已实现
- [x] 药品列表展示
- [x] 添加药品表单
- [x] 编辑药品功能
- [x] 删除药品功能
- [x] 拍照功能
- [x] 记录保存
- [x] 进度计算
- [x] 历史记录展示
- [x] 本地数据存储

### ⏳ 待后端支持
- [ ] API 接口集成
- [ ] 实时同步
- [ ] 云端存储
- [ ] 用户认证

---

**文档版本**: 1.0  
**最后更新**: 2026-01-03

