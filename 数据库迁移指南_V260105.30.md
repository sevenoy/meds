# æ•°æ®åº“è¿ç§»æŒ‡å— - V260105.30

## âš ï¸ ç´§æ€¥ï¼šå¿…é¡»æ‰§è¡Œæ•°æ®åº“è¿ç§»

æ ¹æ®è¿è¡Œæ—¶æ—¥å¿—ï¼Œæ£€æµ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
```
âŒ ç‰ˆæœ¬æ£€æŸ¥å¤±è´¥: {code: '42703', message: 'column app_state.required_version does not exist'}
```

## ğŸ“‹ è¿ç§»æ­¥éª¤

### 1. ç™»å½• Supabase Dashboard
è®¿é—®ï¼šhttps://supabase.com/dashboard/project/ptmgncjechjprxtndqon

### 2. æ‰“å¼€ SQL Editor
å·¦ä¾§èœå• â†’ SQL Editor â†’ New Query

### 3. å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹ SQL

```sql
-- ============================================
-- å¼ºåˆ¶ç‰ˆæœ¬åŒæ­¥ + å®Œå…¨äº‘ç«¯åŒ–è¿ç§»è„šæœ¬
-- ç›®æ ‡ï¼šæ‰€æœ‰è®¾å¤‡å¿…é¡»ä½¿ç”¨ç›¸åŒç‰ˆæœ¬ï¼Œæ‰€æœ‰æ•°æ®ä»äº‘ç«¯è¯»å–
-- ============================================

-- 1. åœ¨ app_state è¡¨æ·»åŠ  required_version å­—æ®µ
ALTER TABLE app_state 
ADD COLUMN IF NOT EXISTS required_version TEXT;

-- 2. è®¾ç½®å½“å‰æœ€æ–°ç‰ˆæœ¬ï¼ˆæ‰€æœ‰è®¾å¤‡å¿…é¡»æ›´æ–°åˆ°æ­¤ç‰ˆæœ¬ï¼‰
UPDATE app_state 
SET required_version = 'V260105.30'
WHERE required_version IS NULL;

-- 3. æ·»åŠ  medications è¡¨ç¼ºå¤±å­—æ®µï¼ˆç¡®ä¿å…¼å®¹ï¼‰
ALTER TABLE medications 
ADD COLUMN IF NOT EXISTS accent TEXT,
ADD COLUMN IF NOT EXISTS device_id TEXT;

-- 4. æ·»åŠ  medication_logs è¡¨ç¼ºå¤±å­—æ®µ
ALTER TABLE medication_logs 
ADD COLUMN IF NOT EXISTS device_id TEXT;

-- 5. åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX IF NOT EXISTS idx_medications_user_device ON medications(user_id, device_id);
CREATE INDEX IF NOT EXISTS idx_medication_logs_user_device ON medication_logs(user_id, device_id);
CREATE INDEX IF NOT EXISTS idx_app_state_required_version ON app_state(required_version);

-- 6. æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN app_state.required_version IS 'å¼ºåˆ¶è¦æ±‚çš„å‰ç«¯ç‰ˆæœ¬å·ï¼Œä¸ä¸€è‡´åˆ™å¼ºåˆ¶åˆ·æ–°';
COMMENT ON COLUMN medications.device_id IS 'æœ€åæ›´æ–°çš„è®¾å¤‡IDï¼ˆç”¨äº Realtime è¿‡æ»¤ï¼‰';
COMMENT ON COLUMN medication_logs.device_id IS 'åˆ›å»ºè®°å½•çš„è®¾å¤‡IDï¼ˆç”¨äº Realtime è¿‡æ»¤ï¼‰';
```

### 4. ç‚¹å‡» "Run" æ‰§è¡Œ

### 5. éªŒè¯è¿ç§»æˆåŠŸ

æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢éªŒè¯ï¼š
```sql
-- æ£€æŸ¥ required_version åˆ—æ˜¯å¦å­˜åœ¨
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'app_state' AND column_name = 'required_version';

-- æ£€æŸ¥å½“å‰ç‰ˆæœ¬è®¾ç½®
SELECT owner_id, required_version, updated_at 
FROM app_state 
LIMIT 5;
```

é¢„æœŸç»“æœï¼š
- ç¬¬ä¸€ä¸ªæŸ¥è¯¢åº”è¿”å› `required_version | text`
- ç¬¬äºŒä¸ªæŸ¥è¯¢åº”æ˜¾ç¤º `required_version = 'V260105.30'`

## âœ… è¿ç§»å®Œæˆå

1. åˆ·æ–°æ‰€æœ‰è®¾å¤‡çš„æµè§ˆå™¨é¡µé¢ï¼ˆCtrl+Shift+R / Cmd+Shift+Rï¼‰
2. ç‰ˆæœ¬æ£€æŸ¥é”™è¯¯åº”æ¶ˆå¤±
3. æ‰€æœ‰è®¾å¤‡å°†å¼ºåˆ¶ä½¿ç”¨ V260105.30

## ğŸ”§ å¦‚æœè¿ç§»å¤±è´¥

å¦‚æœé‡åˆ°æƒé™é”™è¯¯æˆ–å…¶ä»–é—®é¢˜ï¼Œè¯·æä¾›å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

- æ­¤è¿ç§»æ˜¯**å¹‚ç­‰çš„**ï¼ˆå¯ä»¥é‡å¤æ‰§è¡Œï¼‰
- ä¸ä¼šåˆ é™¤ä»»ä½•ç°æœ‰æ•°æ®
- åªæ·»åŠ æ–°åˆ—å’Œç´¢å¼•
- æ‰€æœ‰ `IF NOT EXISTS` ç¡®ä¿å®‰å…¨æ€§

