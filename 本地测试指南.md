# 🧪 Meds 本地测试指南

## 📅 测试时间
2026年1月3日

---

## ✅ 当前状态

### 开发服务器
- ✅ **已启动**
- 🌐 **访问地址**: http://localhost:5173/meds/
- 📦 **Vite 版本**: 6.4.1

### Supabase 项目
- ⏳ **状态**: 正在恢复中（COMING_UP）
- 🔗 **URL**: https://ptmgncjechjprxtndqon.supabase.co
- ⚠️ **注意**: 需要等待项目完全恢复后才能正常使用

---

## 🧪 测试步骤

### 第一步：打开应用

在浏览器中访问：
```
http://localhost:5173/meds/
```

**预期结果**：
- 看到登录页面
- 或者看到 Supabase 连接错误（如果项目还在恢复中）

---

### 第二步：等待 Supabase 恢复

#### 方法 1：使用检查脚本

打开新终端，运行：
```bash
cd /Users/lorenmac/Downloads/26年软件项目/Meds/meds
node check-project-status.js
```

每隔 5 分钟运行一次，直到看到：
```
✅ 基础连接成功
✅ 数据库连接成功
✅ Realtime 端点可用
✅ Storage 连接成功
🎉 项目已完全恢复！
```

#### 方法 2：在应用中观察

刷新浏览器页面：
- ❌ **项目未恢复**: 显示连接错误
- ✅ **项目已恢复**: 显示正常登录页面

---

### 第三步：登录测试

#### 3.1 使用现有账号登录

**测试数据**（如果您有现有账号）：
- 邮箱：您的注册邮箱
- 密码：您的密码

**预期结果**：
- ✅ 成功登录
- ✅ 加载用户数据
- ✅ 显示药品列表
- ✅ 右上角显示同步状态指示器

#### 3.2 如果忘记密码

参考文档：`CREATE_USER_GUIDE.md`

---

### 第四步：核心功能测试

#### 4.1 药品管理测试

**测试用例 1：添加药品**
1. 点击 "添加药品" 按钮
2. 填写药品信息：
   - 名称：阿莫西林
   - 剂量：500mg
   - 频率：每日3次
   - 时间：08:00, 14:00, 20:00
3. 点击保存

**预期结果**：
- ✅ 药品成功添加
- ✅ 列表中显示新药品
- ✅ 右上角显示 "同步成功" 提示

**测试用例 2：编辑药品**
1. 点击药品卡片的编辑按钮
2. 修改剂量为 250mg
3. 保存

**预期结果**：
- ✅ 修改成功
- ✅ 显示更新后的信息
- ✅ 同步到云端

**测试用例 3：删除药品**
1. 点击药品卡片的删除按钮
2. 确认删除

**预期结果**：
- ✅ 药品从列表中移除
- ✅ 云端数据同步删除

---

#### 4.2 服药记录测试

**测试用例 1：添加服药记录**
1. 点击药品卡片上的 "服药" 按钮
2. 选择当前时间
3. 点击确认

**预期结果**：
- ✅ 记录成功添加
- ✅ 显示服药时间
- ✅ 药品卡片状态更新

**测试用例 2：拍照记录**
1. 点击 "拍照记录" 按钮
2. 选择照片或拍照
3. 保存

**预期结果**：
- ✅ 照片成功上传
- ✅ 显示在记录中
- ✅ Storage 中保存成功

**测试用例 3：查看历史记录**
1. 点击 "历史记录" 按钮
2. 查看所有服药记录

**预期结果**：
- ✅ 显示完整历史
- ✅ 按时间排序
- ✅ 照片正常加载

---

#### 4.3 用户设置测试

**测试用例 1：修改头像**
1. 点击右上角头像
2. 选择新头像
3. 上传

**预期结果**：
- ✅ 头像成功上传
- ✅ 立即显示新头像
- ✅ Storage 中保存

**测试用例 2：修改偏好设置**
1. 进入设置页面
2. 修改提醒时间等设置
3. 保存

**预期结果**：
- ✅ 设置保存成功
- ✅ 同步到云端

---

### 第五步：多设备实时同步测试 ⭐

这是 V251219.43 版本的核心功能！

#### 5.1 准备工作

**需要准备**：
- 设备 A：当前电脑（http://localhost:5173/meds/）
- 设备 B：手机或另一台电脑（同一网络下访问局域网 IP）

**获取局域网 IP**：
```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# 或者
ipconfig getifaddr en0
```

假设您的 IP 是 `192.168.1.100`，则设备 B 访问：
```
http://192.168.1.100:5173/meds/
```

#### 5.2 同步测试用例

**测试用例 1：添加药品同步**
1. 设备 A：添加新药品 "维生素C"
2. 设备 B：观察（无需刷新）

**预期结果**：
- ✅ 设备 B 在 1-2 秒内自动显示新药品
- ✅ 设备 B 显示 "收到远程更新" 提示
- ✅ 两设备数据完全一致

**测试用例 2：编辑药品同步**
1. 设备 B：编辑 "维生素C" 的剂量
2. 设备 A：观察

**预期结果**：
- ✅ 设备 A 自动更新显示
- ✅ 同步延迟 < 2 秒

**测试用例 3：删除药品同步**
1. 设备 A：删除某个药品
2. 设备 B：观察

**预期结果**：
- ✅ 设备 B 自动移除该药品
- ✅ 无需手动刷新

**测试用例 4：冲突解决**
1. 断开设备 B 的网络
2. 设备 A：修改药品 A 的剂量为 100mg
3. 设备 B：修改同一药品的剂量为 200mg
4. 重新连接设备 B 的网络
5. 等待同步

**预期结果**：
- ✅ 自动解决冲突
- ✅ 采用最后修改的值（LWW 策略）
- ✅ 两设备最终一致

---

#### 5.3 同步状态指示器测试

**位置**：右上角

**状态测试**：

1. **正常连接**
   - 显示：🟢 已连接
   - 点击：显示详细状态

2. **断开网络**
   - 显示：🔴 未连接
   - 自动尝试重连

3. **重新连接**
   - 显示：🔵 连接中
   - 成功后变为：🟢 已连接

4. **手动重连**
   - 点击状态指示器
   - 点击 "重新连接" 按钮
   - 观察连接过程

---

### 第六步：性能测试

#### 6.1 同步延迟测试

**步骤**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 在设备 A 添加药品
4. 观察设备 B 的控制台

**查看日志**：
```
📥 收到远程更新: medications
⏱️ 同步延迟: 0.8 秒
```

**验收标准**：
- ✅ 平均延迟 < 2 秒
- ✅ 99% 的操作在 3 秒内同步

#### 6.2 连接稳定性测试

**步骤**：
1. 保持应用打开 30 分钟
2. 观察同步状态指示器
3. 期间进行多次操作

**验收标准**：
- ✅ 连接保持稳定
- ✅ 无异常断开
- ✅ 所有操作正常同步

#### 6.3 大量数据测试

**步骤**：
1. 添加 20+ 个药品
2. 添加 50+ 条服药记录
3. 测试同步性能

**验收标准**：
- ✅ 同步速度不受影响
- ✅ 界面响应流畅
- ✅ 无明显卡顿

---

### 第七步：离线功能测试

#### 7.1 离线添加数据

**步骤**：
1. 断开网络连接
2. 添加新药品
3. 添加服药记录
4. 重新连接网络

**预期结果**：
- ✅ 离线时可以正常操作
- ✅ 数据保存在本地
- ✅ 联网后自动同步到云端
- ✅ 其他设备收到更新

#### 7.2 离线编辑数据

**步骤**：
1. 断开网络
2. 编辑现有药品
3. 删除某些记录
4. 重新连接

**预期结果**：
- ✅ 离线修改成功保存
- ✅ 联网后正确同步
- ✅ 无数据丢失

---

## 🐛 常见问题排查

### 问题 1：无法连接到 Supabase

**症状**：
- 显示连接错误
- 无法登录

**解决方案**：
```bash
# 检查项目状态
node check-project-status.js

# 如果项目还在恢复中，等待 5-15 分钟
```

### 问题 2：Realtime 不工作

**症状**：
- 同步状态显示 🔴 未连接
- 多设备不同步

**解决方案**：
1. 检查浏览器控制台错误
2. 确认 Realtime 已启用：
   - 访问 Supabase Dashboard
   - Database → Replication
   - 确认表已启用

### 问题 3：头像无法上传

**症状**：
- 上传失败
- 显示错误提示

**解决方案**：
1. 检查 Storage 配置
2. 确认 `avatars` bucket 存在
3. 验证 RLS 策略

### 问题 4：数据不同步

**症状**：
- 设备 B 看不到设备 A 的更新

**解决方案**：
1. 检查两设备是否登录同一账号
2. 查看同步状态指示器
3. 手动点击 "重新连接"
4. 查看控制台错误日志

---

## 📊 测试报告模板

测试完成后，记录结果：

```
### 测试报告

**测试时间**: 2026年1月3日
**测试人员**: [您的名字]
**版本**: V251219.43

#### 功能测试
- [ ] 登录功能 - 通过/失败
- [ ] 药品管理 - 通过/失败
- [ ] 服药记录 - 通过/失败
- [ ] 用户设置 - 通过/失败

#### 多设备同步测试
- [ ] 添加同步 - 通过/失败
- [ ] 编辑同步 - 通过/失败
- [ ] 删除同步 - 通过/失败
- [ ] 冲突解决 - 通过/失败

#### 性能测试
- 平均同步延迟: ___ 秒
- 连接稳定性: 通过/失败
- 大量数据测试: 通过/失败

#### 问题记录
1. [问题描述]
2. [问题描述]

#### 总体评价
[您的评价]
```

---

## 🎯 验收标准

所有以下项目都通过才算测试成功：

### 基础功能
- [ ] 登录/登出正常
- [ ] 药品 CRUD 操作正常
- [ ] 服药记录功能正常
- [ ] 照片上传正常
- [ ] 用户设置保存正常

### 多设备同步
- [ ] 实时同步延迟 < 2 秒
- [ ] 连接状态指示正确
- [ ] 自动重连机制工作
- [ ] 冲突自动解决
- [ ] 数据最终一致性 100%

### 性能指标
- [ ] 界面响应流畅
- [ ] 无明显卡顿
- [ ] 内存占用合理
- [ ] 网络流量正常

### 用户体验
- [ ] 操作直观易懂
- [ ] 反馈及时清晰
- [ ] 错误提示友好
- [ ] 无明显 Bug

---

## 📚 相关文档

测试过程中可参考：
- `REALTIME_TESTING_GUIDE.md` - 详细测试指南
- `MULTI_DEVICE_SYNC_TEST.md` - 多设备测试
- `V251219.43_多设备即时同步.md` - 功能说明

---

## 🔧 开发者工具

### 查看实时日志

打开浏览器控制台（F12），查看：
- Supabase 连接状态
- Realtime 订阅信息
- 同步事件日志
- 错误信息

### 有用的命令

```bash
# 检查项目状态
node check-project-status.js

# 重启开发服务器
# Ctrl+C 停止，然后：
npm run dev

# 清除缓存重新测试
npm run build

# 查看构建产物
ls -lh dist/
```

---

## ✅ 测试完成后

1. **停止开发服务器**
   - 在终端按 `Ctrl+C`

2. **记录测试结果**
   - 填写测试报告

3. **如果测试通过**
   - 可以进行生产构建
   - 准备部署

4. **如果发现问题**
   - 记录详细信息
   - 查看相关文档
   - 寻求帮助

---

**祝测试顺利！** 🎉

有任何问题随时查看文档或寻求帮助。

