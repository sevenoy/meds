# 🎉 Supabase 项目恢复后操作清单

## 📅 更新时间
2026年1月2日

---

## ✅ 第一步：验证项目状态

### 1.1 检查项目连接
```bash
node check-project-status.js
```

**预期结果**：
- ✅ 基础连接成功
- ✅ 数据库连接成功
- ✅ Realtime 端点可用
- ✅ Storage 连接成功

### 1.2 验证 Realtime 功能
在 Supabase Dashboard 确认：
1. 访问：Database → Replication
2. 确认以下表已启用 Realtime：
   - ✅ `medications`
   - ✅ `medication_logs`
   - ✅ `user_settings`

---

## ✅ 第二步：测试应用功能

### 2.1 安装依赖（如需要）
```bash
npm install
```

### 2.2 本地测试
```bash
npm run dev
```

### 2.3 测试核心功能

**登录功能**：
- [ ] 使用现有账号登录
- [ ] 验证用户数据加载正常

**药品管理**：
- [ ] 添加新药品
- [ ] 编辑药品信息
- [ ] 删除药品

**服药记录**：
- [ ] 添加服药记录
- [ ] 拍照上传
- [ ] 查看历史记录

**多设备同步**（重要！）：
- [ ] 在设备 A 添加药品
- [ ] 在设备 B 查看（应自动显示）
- [ ] 验证同步状态指示器
- [ ] 测试离线后重连

---

## ✅ 第三步：重新构建和部署

### 3.1 构建生产版本
```bash
npm run build
```

### 3.2 验证构建产物
检查 `dist/` 目录是否生成成功

### 3.3 部署（根据您的部署方式）
```bash
# 如果使用特定部署命令，在此执行
```

---

## ✅ 第四步：数据验证

### 4.1 检查数据完整性
登录应用后验证：
- [ ] 所有药品数据都在
- [ ] 服药记录完整
- [ ] 用户设置保留
- [ ] 头像图片正常显示

### 4.2 检查快照功能
```sql
-- 在 Supabase SQL Editor 执行
SELECT COUNT(*) FROM snapshots;
```

---

## ✅ 第五步：监控和优化

### 5.1 监控 Realtime 连接
- 打开应用
- 查看右上角同步状态指示器
- 应显示 🟢 **已连接**

### 5.2 性能测试
参考文档：
- `REALTIME_TESTING_GUIDE.md`
- `MULTI_DEVICE_SYNC_TEST.md`

---

## 🚨 如果遇到问题

### 问题 1：无法连接到 Supabase
**解决方案**：
1. 确认项目状态为 ACTIVE
2. 检查网络连接
3. 清除浏览器缓存
4. 运行 `node check-project-status.js`

### 问题 2：Realtime 不工作
**解决方案**：
1. 检查 Database → Replication 设置
2. 确认表已启用 Realtime
3. 查看浏览器控制台错误
4. 参考 `REALTIME_SETUP_GUIDE.md`

### 问题 3：数据丢失
**解决方案**：
1. 检查 RLS 策略
2. 确认用户 ID 正确
3. 查看 Supabase Dashboard 的表数据

### 问题 4：头像无法加载
**解决方案**：
1. 检查 Storage 设置
2. 确认 `avatars` bucket 存在
3. 验证 RLS 策略
4. 参考 `STORAGE_SETUP_GUIDE.md`

---

## 📞 需要帮助？

如果项目恢复后遇到任何问题：

1. **查看相关文档**：
   - `REALTIME_SETUP_GUIDE.md`
   - `STORAGE_SETUP_GUIDE.md`
   - `SUPABASE_SETUP.md`

2. **运行诊断脚本**：
   ```bash
   node check-project-status.js
   node test-api.js
   ```

3. **联系 Supabase 支持**：
   - 如果超过 30 分钟仍未恢复
   - 访问：https://app.supabase.com/support/new

---

## 💡 预防未来暂停

### 方案 1：升级到 Pro 计划
- 费用：$25/月
- 优势：项目不会因不活跃而暂停

### 方案 2：保持项目活跃
- 定期使用应用（至少每周一次）
- 设置定时任务保持连接

### 方案 3：定期备份
```bash
# 导出数据库
pg_dump -h db.ptmgncjechjprxtndqon.supabase.co \
  -U postgres \
  -d postgres \
  > backup.sql
```

---

## ✅ 完成确认

当以下所有项都完成时，恢复过程就完成了：

- [ ] 项目状态为 ACTIVE
- [ ] 所有连接测试通过
- [ ] 应用可以正常登录
- [ ] 核心功能测试通过
- [ ] 多设备同步正常工作
- [ ] 数据完整性验证通过
- [ ] 生产版本已重新构建
- [ ] 应用已重新部署

---

**祝您使用愉快！** 🎉

如有任何问题，请随时查阅项目文档或寻求帮助。

